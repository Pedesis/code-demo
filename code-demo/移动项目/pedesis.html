<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/css.css">
</head>

<body>
    <div id="wrap">
        
        <div class="head">
            <div class="head-top">
                <a href="javascript:;"><img src="images/logo.png" alt=""></a>
                <a href="javascript:;" class="menu-img"></a>
                <div class="btns">
                    <a href="javascript:;">搜索</a>
                    <a href="javascript:;">登陆</a>
                    <a href="javascript:;">注册</a>
                </div>
            </div>
            <div class="head-bottom">
                <form action="" method="get">
                    <input type="text" placeholder="请搜索">
                    <input type="button" value="搜索">
                </form>
            </div>
            <ul class="mask">
                <li><a href="javascript:;">首页</a></li>
                <li><a href="javascript:;">MV</a></li>
                <li><a href="javascript:;">悦单</a></li>
                <li><a href="javascript:;">V榜</a></li>
                <li><a href="javascript:;">音乐</a></li>
                <li><a href="javascript:;">商城</a></li>
                <li><a href="javascript:;">节目</a></li>
                <li><a href="javascript:;">饭团</a></li>
                <li><a href="javascript:;">咨询</a></li>
                <li><a href="javascript:;">我的家</a></li>
                <li><a href="javascript:;">App下载</a></li>
                <li><a href="javascript:;">热门应用</a></li>
            </ul>
        </div>
        <div class="content">
            <div>
                    <div class="nav">
                            <ul class="list">
                                <li class="slipactive"><a href="javascript:;">首页</a></li>
                                <li><a href="javascript:;">MV</a></li>
                                <li><a href="javascript:;">悦单</a></li>
                                <li><a href="javascript:;">V榜</a></li>
                                <li><a href="javascript:;">音乐</a></li>
                                <li><a href="javascript:;">商城</a></li>
                                <li><a href="javascript:;">节目</a></li>
                                <li><a href="javascript:;">饭团</a></li>
                                <li><a href="javascript:;">咨询</a></li>
                                <li><a href="javascript:;">我的家</a></li>
                                <li><a href="javascript:;">App下载</a></li>
                                <li><a href="javascript:;">热门应用</a></li>
                                <li><a href="javascript:;">1</a></li>
                                <li><a href="javascript:;">2</a></li>
                                <li><a href="javascript:;">3</a></li>
                                <li><a href="javascript:;">4</a></li>
                                <li><a href="javascript:;">5</a></li>
                                <li><a href="javascript:;">6</a></li>
                                <li><a href="javascript:;">7</a></li>
                                <li><a href="javascript:;">8</a></li>
                                <li><a href="javascript:;">9</a></li>
                                <li><a href="javascript:;">0</a></li>
                            </ul>
                    </div>
                    <div class="carousel-wrap"  needCarousel needMove>
                            <!-- <div class="carousel-point" ></div> -->
                    </div>
                    <div class="tap-wrap">
                        <div class="tap-head">
                            <span>MV主播</span>
                            <span>更多&gt;</span>
                        </div>
                        <div class="tap-nav">
                            <a href="javascript:;">全部</a>
                            <a href="javascript:;">内地</a>
                            <a href="javascript:;">港台</a>
                            <a href="javascript:;">欧美</a>
                            <a href="javascript:;">韩国</a>
                            <a href="javascript:;">日本</a>
                            <div class="green-tap"></div>
                        </div>
                        <div class="tap-content">
                            <ul class="loading"></ul>
                            <ul>
                                <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                    <p>君に贈る花がないがないがないがないがないがないがない</p>
                                    </a>
                                    <div class="left">
                                        <span></span>
                                        <span>9176</span>
                                    </div>
                                    <div class="right">
                                        <span></span>
                                        <span>6</span>
                                    </div>
                                </li>
                                <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                    <p>君に贈る花がないがないがないがないがないがないがない</p>
                                    </a>
                                    <div class="left">
                                        <span></span>
                                        <span>9176</span>
                                    </div>
                                    <div class="right">
                                        <span></span>
                                        <span>6</span>
                                    </div>
                                </li>
                                <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                    <p>君に贈る花がないがないがないがないがないがないがない</p>
                                    </a>
                                    <div class="left">
                                        <span></span>
                                        <span>9176</span>
                                    </div>
                                    <div class="right">
                                        <span></span>
                                        <span>6</span>
                                    </div>
                                </li>
                                <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                    <p>君に贈る花がないがないがないがないがないがないがない</p>
                                    </a>
                                    <div class="left">
                                        <span></span>
                                        <span>9176</span>
                                    </div>
                                    <div class="right">
                                        <span></span>
                                        <span>6</span>
                                    </div>
                                </li>
                                <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                    <p>君に贈る花がないがないがないがないがないがないがない</p>
                                    </a>
                                    <div class="left">
                                        <span></span>
                                        <span>9176</span>
                                    </div>
                                    <div class="right">
                                        <span></span>
                                        <span>6</span>
                                    </div>
                                </li>
                                <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                    <p>君に贈る花がないがないがないがないがないがないがない</p>
                                    </a>
                                    <div class="left">
                                        <span></span>
                                        <span>9176</span>
                                    </div>
                                    <div class="right">
                                        <span></span>
                                        <span>6</span>
                                    </div>
                                </li>
                            </ul>
                            <ul class="loading"></ul>
                        </div>
                    </div>
                    <div class="tap-wrap">
                            <div class="tap-head">
                                <span>MV主播</span>
                                <span>更多&gt;</span>
                            </div>
                            <div class="tap-nav">
                                <a href="javascript:;">全部</a>
                                <a href="javascript:;">内地</a>
                                <a href="javascript:;">港台</a>
                                <a href="javascript:;">欧美</a>
                                <a href="javascript:;">韩国</a>
                                <a href="javascript:;">日本</a>
                                <div class="green-tap"></div>
                            </div>
                            <div class="tap-content">
                                <ul class="loading"></ul>
                                <ul>
                                    <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                        <p>君に贈る花がないがないがないがないがないがないがない</p>
                                        </a>
                                        <div class="left">
                                            <span></span>
                                            <span>9176</span>
                                        </div>
                                        <div class="right">
                                            <span></span>
                                            <span>6</span>
                                        </div>
                                    </li>
                                    <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                        <p>君に贈る花がないがないがないがないがないがないがない</p>
                                        </a>
                                        <div class="left">
                                            <span></span>
                                            <span>9176</span>
                                        </div>
                                        <div class="right">
                                            <span></span>
                                            <span>6</span>
                                        </div>
                                    </li>
                                    <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                        <p>君に贈る花がないがないがないがないがないがないがない</p>
                                        </a>
                                        <div class="left">
                                            <span></span>
                                            <span>9176</span>
                                        </div>
                                        <div class="right">
                                            <span></span>
                                            <span>6</span>
                                        </div>
                                    </li>
                                    <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                        <p>君に贈る花がないがないがないがないがないがないがない</p>
                                        </a>
                                        <div class="left">
                                            <span></span>
                                            <span>9176</span>
                                        </div>
                                        <div class="right">
                                            <span></span>
                                            <span>6</span>
                                        </div>
                                    </li>
                                    <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                        <p>君に贈る花がないがないがないがないがないがないがない</p>
                                        </a>
                                        <div class="left">
                                            <span></span>
                                            <span>9176</span>
                                        </div>
                                        <div class="right">
                                            <span></span>
                                            <span>6</span>
                                        </div>
                                    </li>
                                    <li><a href="javascript:;"><img src="images/a.jpg" alt="">
                                        <p>君に贈る花がないがないがないがないがないがないがない</p>
                                        </a>
                                        <div class="left">
                                            <span></span>
                                            <span>9176</span>
                                        </div>
                                        <div class="right">
                                            <span></span>
                                            <span>6</span>
                                        </div>
                                    </li>
                                </ul>
                                <ul class="loading"></ul>
                            </div>
                    </div>
                    
            </div>
            <div class="scrollBox"></div>
       
    </div>
</div>
</body>
<script src="js/transform.js"></script>
<script>

    window.onload = function () {
        
        document.addEventListener("touchstart", function (e) {
            ev = e || event;
            e.preventDefault();
        })
        var styleNode = document.createElement("style");
        var w = document.documentElement.clientWidth / 16;
        styleNode.innerHTML = "html{font-size:" + w + "px!important}"
        document.head.appendChild(styleNode);
        dragY();
        function dragY(){
            var navDiv=document.querySelector("#wrap>.content");
            var scrollBox=document.querySelector("#wrap .content .scrollBox");
            scrollBox.style.height=navDiv.clientHeight*(navDiv.clientHeight/navDiv.children[0].offsetHeight)+"px";
            var callBack={
            start:function(){
                scrollBox.style.opacity=1;
            },
            move:function(){
                var scale=pedesis.transfromCss(this,"translateY")/(navDiv.children[0].offsetHeight-navDiv.clientHeight);
                pedesis.transfromCss(scrollBox,"translateY",-scale*(navDiv.clientHeight-scrollBox.offsetHeight));
            },
            end:function(){    
                scrollBox.style.opacity=0;
            }
           
        }
        pedesis.dragMoveY(navDiv,callBack);
        }

        changemenu();
        function changemenu(){
            var menuImg=document.querySelector(".menu-img");
            var maskUl=document.querySelector(".mask");
            var flag=false;
            menuImg.addEventListener("touchstart",function(e){
                e=e||event;
                flag=!flag;
                if(flag){
                    pedesis.addClass(menuImg,"active");
                    maskUl.style.display="block";

                }else{
                    pedesis.removeClass(menuImg,"active");
                    maskUl.style.display="none";
                }
                e.stopPropagation();
                e.preventDefault();
            })
            document.addEventListener("touchstart",function(){
                if(flag){
                    pedesis.removeClass(menuImg,"active");
                maskUl.style.display="none";
                flag=!flag;
                }
            })
            maskUl.addEventListener("touchstart",function(e){
                    e=e||event;
                    e.stopPropagation();
                e.preventDefault();
            })

        }
        
        changeFocus();
        function changeFocus(){
            var headInput=document.querySelector(".head-bottom input[type='text']");
            headInput.addEventListener("touchstart",function(e){
                e=e||event;
                this.focus();
                e.stopPropagation();
                e.preventDefault();
            })
            document.addEventListener("touchstart",function(){
                headInput.blur();
            })
        }
        drag();
        //导航移动逻辑
        function drag(){
            var navDiv=document.querySelector(".nav");
            var listUl=document.querySelector(".nav>.list")
            var startX=0;
            var trX=0;
            var translateX=0;
            var lastTime=0;
            var lastPoint=0;
            var pointDis=0,timeDis=1;
            var minX=document.documentElement.clientWidth-listUl.offsetWidth;
           // console.log(minX);
            navDiv.addEventListener("touchstart",function(e){
                e=e||event;
                listUl.style.transition="none";
                startX=e.changedTouches[0].clientX;
             
                trX=pedesis.transfromCss(listUl,"translateX");
               
                lastTime=new Date().getTime();
                lastPoint=startX;
                pointDis=0;
                listUl.handMove=false;
                
            })
            navDiv.addEventListener("touchmove",function(e){
                e=e||event;
                nowX=e.changedTouches[0].clientX;
                var distX=nowX-startX;
                    translateX=trX+distX;
                    


                var nowTime=new Date().getTime();
                var nowPoint=nowX;
                pointDis=nowPoint-lastPoint;
                timeDis=nowTime-lastTime;
                
                lastPoint=nowPoint;
                lastTime=nowTime;
            
                //console.log(listUl.offsetWidth)

                if(translateX>0){
                    listUl.handMove=true;
                    var scale=document.documentElement.clientWidth/((document.documentElement.clientWidth+translateX)*1.5);
                    translateX=pedesis.transfromCss(listUl,"translateX")+pointDis*scale;
                }else if(translateX<minX){
                    listUl.handMove=true;
                    var over=document.documentElement.clientWidth/((document.documentElement.clientWidth+minX-translateX)*1.5);
                    translateX=pedesis.transfromCss(listUl,"translateX")+pointDis*over;
                }
                pedesis.transfromCss(listUl,"translateX",translateX);

            })
            navDiv.addEventListener("touchend",function(){
                translateX=pedesis.transfromCss(listUl,"translateX");
               // console.log(!listUl.handMove);
                if(!listUl.handMove){
                    var bsr="";
                    var  speed=pointDis/timeDis;
                speed=Math.abs(speed)<0.5?0:speed;
                
                var target=translateX+speed*200;
               // console.log(speed,target,translateX);
                var time=Math.abs(speed)*0.2;
                time=time<0.8?0.8:time;
                time=time>2?2:time;
                if(target>0){
                    target=0;
                    bsr="cubic-bezier(.02,.84,.7,1.53)";
                }else if(target<minX){
                    target=minX;
                    bsr="cubic-bezier(.02,.84,.7,1.53)";
                }
                //listUl.style.transition="10s "+bsr+" transform";
                listUl.style.transition=time+"s "+bsr+" transform";
                pedesis.transfromCss(listUl,"translateX",target);
                console.log("end"+pedesis.transfromCss(listUl,"translateX"));
                }else{
                    listUl.style.transition="1s transform";
                    if(translateX>0){
                        translateX=0;
                }else if(translateX<minX){
                    translateX=minX;
                    
                }
                pedesis.transfromCss(listUl,"translateX",translateX);
                console.log("end"+pedesis.transfromCss(listUl,"translateX"));
                }

            })
        }
        //更改拖动颜色
        changeColor();
        function changeColor(){
            var  listLinode=document.querySelectorAll(".content .nav .list>li");
            var  listUlnode=document.querySelector(".content .nav .list");
            var judge;
            listUlnode.addEventListener("touchstart",function(){
                judge=false;
            })
            listUlnode.addEventListener("touchmove",function(){
                judge=true;
            })
            listUlnode.addEventListener("touchend",function(e){
                if(judge){
                    return;
                }
                e=e||event;
                for(var i=0;i<listLinode.length;i++){
                    pedesis.removeClass(listLinode[i],"slipactive");
                }
                //console.log(e.changedTouches[0].target.nodeName);
                if(e.changedTouches[0].target.nodeName==="A"){
                    
                    pedesis.addClass(e.changedTouches[0].target.parentNode,"slipactive");
                    
                }else if(e.changedTouches[0].target.nodeName==="LI"){
                    pedesis.addClass(e.changedTouches[0].target,"slipactive");
                }

            })
        }
        //滑屏
        carousel();
        function carousel(){
        var arr = ["01.jpg", "02.jpg", "03.jpg", "04.jpg", "05.jpg"];
        pedesis.carouselimg(arr);
        }
        //mv区滑屏
        slipMV();
        function slipMV(){
            var wrap=document.querySelectorAll(".tap-wrap ");
            var tapContent=document.querySelectorAll(".tap-wrap .tap-content");
            var w=wrap[0].offsetWidth;
            
           //console.log(tapContent);
            for(var i=0;i<tapContent.length;i++){
                move(tapContent[i]);
            }
           
            function move(content){
                var now=0;
            var loadingUl=content.querySelectorAll(".loading");
            var atapNav=content.parentNode.querySelectorAll(".tap-wrap .tap-nav a");
            var greenTap=content.parentNode.querySelector(".tap-wrap .tap-nav .green-tap");
                pedesis.transfromCss(content,"translateX",-w)
                var start={x:0,y:0};
                var element=0;
                var isX=true;
                var isFirst=true;
                var translateX=0;

                var isOnce=false;
                content.addEventListener("touchstart",function(e){
                  
                        e=e||event;
                        var touchC=e.changedTouches[0];
                        start.x=touchC.clientX;
                        start.y=touchC.clientY;
                        element=pedesis.transfromCss(content,"translateX");
                        isX=true;
                        isFirst=true;
                        isOnce=false;
                        if(isOnce){
                        return;
                    }
                })
                content.addEventListener("touchmove",function(e){
                    if(isOnce){
                        return;
                    }
                    if(!isX){
                        return;
                    }
                    e=e||event;
                    var now={x:0,y:0};
                    var touchC=e.changedTouches[0];
                        now.x=touchC.clientX;
                        now.y=touchC.clientY;
                        var distX=now.x-start.x;
                        var distY=now.y-start.y;
                         translateX=distX+element;
                        if(isFirst){
                                isFirst=false;
                                if(Math.abs(distY)>Math.abs(distX)){
                                isX=false;
                                return;
                            
                                }
                            }
                      
                        pedesis.transfromCss(content,"translateX",translateX);  
                        jump(distX); 
                })
                function jump(distX){
                    if(isOnce){
                        return;
                    }
                   
                    if(Math.abs(distX)>w/2){
                       // debugger
                        content.style.transition="1s transform";
                        isOnce=true;
                        //console.log("111");
                        var target=0;
                        if(distX>0){
                            target=0;
                        }else{
                            target=-2*w;
                        }
                        pedesis.transfromCss(content,"translateX",target);

                        content.addEventListener("transitioned",request);
                        content.addEventListener("webkitTransitionEnd",request);
                    
                    function request(){
                        
                        content.removeEventListener("tranitioned",request);
                        content.removeEventListener("webkitTransitionEnd",request);
                        content.style.transition="none";
                        for(var i=0;i<loadingUl.length;i++){
                            loadingUl[i].style.opacity=1;
                        }
                        distX<0?now++:now--;
                        if(now<0){
                            now=atapNav.length-1;
                        }else if(now>atapNav.length-1){
                            now=0;
                        }

                        pedesis.transfromCss(greenTap,"translateX",now*atapNav[0].offsetWidth);
                        setTimeout(function(){
                            
                            for(var i=0;i<loadingUl.length;i++){
                            loadingUl[i].style.opacity=0;
                        }
                            pedesis.transfromCss(content,"translateX",-w);
                        },1000)

                    }
                    }
                }
                content.addEventListener("touchend",function(e){
                    if(isOnce){
                        return;
                    }
                    e=e||event;
                    var now={x:0,y:0};
                    var touchC=e.changedTouches[0];
                        now.x=touchC.clientX;
                        
                       
                    var distX=now.x-start.x;
                    if(Math.abs(distX)<=w/2){
                        content.style.transition = "1s transform";
                    pedesis.transfromCss(content,"translateX",-w);
                    }
                    
                })
            }
        }
    }

</script>

</html>